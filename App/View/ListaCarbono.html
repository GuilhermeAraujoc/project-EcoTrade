<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gerenciar Créditos de Carbono - EcoTrade</title>
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background: #0f172a;
        color: #e2e8f0;
        margin: 0;
        padding: 2rem;
      }

      h1 {
        text-align: center;
        color: #22c55e;
        margin-bottom: 2rem;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background-color: #1e293b;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 10px rgba(34, 197, 94, 0.1);
      }

      th,
      td {
        padding: 1rem;
        text-align: left;
      }

      th {
        background-color: #22c55e;
        color: #0f172a;
        font-weight: 600;
      }

      tr:nth-child(even) {
        background-color: #111827;
      }

      select {
        background-color: #0f172a;
        color: #e2e8f0;
        border: 1px solid #22c55e;
        border-radius: 5px;
        padding: 0.3rem;
      }

      button {
        background-color: #22c55e;
        border: none;
        color: #0f172a;
        font-weight: bold;
        border-radius: 5px;
        padding: 0.4rem 0.8rem;
        cursor: pointer;
        transition: 0.2s;
      }

      button:hover {
        background-color: #16a34a;
      }

      .center {
        text-align: center;
      }

      /* === TOASTS === */
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 1000;
      }

      .toast {
        padding: 1rem 1.5rem;
        border-radius: 8px;
        font-weight: 500;
        color: #fff;
        opacity: 0;
        transform: translateY(-10px);
        animation: slideIn 0.3s forwards;
      }

      .toast-success {
        background-color: #22c55e;
      }

      .toast-error {
        background-color: #ef4444;
      }

      @keyframes slideIn {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeOut {
        to {
          opacity: 0;
          transform: translateY(-10px);
        }
      }
    </style>
  </head>
  <body>
    <h1>Gerenciar Créditos de Carbono</h1>

    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Produtor</th>
          <th>Fazenda</th>
          <th>Quantidade (t)</th>
          <th>Data de Geração</th>
          <th>Status</th>
          <th class="center">Ação</th>
        </tr>
      </thead>
      <tbody id="tabelaCarbono"></tbody>
    </table>

    <!-- Container de toasts -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
      async function carregarCarbonos() {
        const response = await fetch("../Model/ModelListaCarbono.php");
        const data = await response.json();

        const tabela = document.getElementById("tabelaCarbono");
        tabela.innerHTML = "";

        data.forEach((item) => {
          const tr = document.createElement("tr");

          tr.innerHTML = `
          <td>${item.id}</td>
          <td>${item.nome_produtor}</td>
          <td>${item.nome_fazenda}</td>
          <td>${item.quantidade}</td>
          <td>${item.data_geracao ?? "-"}</td>
          <td>
            <select id="status_${item.id}">
              <option value="pendente" ${
                item.status === "pendente" ? "selected" : ""
              }>Pendente</option>
              <option value="disponivel" ${
                item.status === "disponivel" ? "selected" : ""
              }>Disponível</option>
              <option value="vendido" ${
                item.status === "vendido" ? "selected" : ""
              }>Vendido</option>
            </select>
          </td>
          <td class="center">
            <button onclick="atualizarStatus(${item.id})">Salvar</button>
          </td>
        `;
          tabela.appendChild(tr);
        });
      }

      // Função que exibe o toast
      function showToast(message, type = "success") {
        const container = document.getElementById("toastContainer");
        const toast = document.createElement("div");
        toast.classList.add(
          "toast",
          type === "success" ? "toast-success" : "toast-error"
        );
        toast.textContent = message;
        container.appendChild(toast);

        // Remove o toast após 3s
        setTimeout(() => {
          toast.style.animation = "fadeOut 0.4s forwards";
          setTimeout(() => toast.remove(), 400);
        }, 3000);
      }

      async function atualizarStatus(id) {
        const novoStatus = document.getElementById(`status_${id}`).value;

        const response = await fetch("../Model/ModelAtualizaStatus.php", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: `id=${id}&status=${novoStatus}`,
        });

        const result = await response.json();

        if (result.success) {
          showToast("✅ Status atualizado com sucesso!", "success");
        } else {
          showToast("❌ Erro ao atualizar o status.", "error");
        }

        carregarCarbonos();
      }

      carregarCarbonos();
    </script>
  </body>
</html>
